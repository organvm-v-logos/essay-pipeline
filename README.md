[![ORGAN-V: Logos](https://img.shields.io/badge/ORGAN--V-Logos-0d47a1?style=flat-square)](https://github.com/organvm-v-logos)
[![CI](https://github.com/organvm-v-logos/essay-pipeline/actions/workflows/ci.yml/badge.svg)](https://github.com/organvm-v-logos/essay-pipeline/actions/workflows/ci.yml)
[![Tier: Standard](https://img.shields.io/badge/tier-standard-blue?style=flat-square)](https://github.com/organvm-iv-taxis/orchestration-start-here)

# essay-pipeline

_Essay automation engine for the ORGAN-V discourse layer_

---

## Overview

essay-pipeline is the automation backbone behind ORGAN-V's public-process discourse layer. Where [public-process](https://github.com/organvm-v-logos/public-process) is the published surface -- the Jekyll site hosting essays, sprint narratives, and meta-system reflections -- essay-pipeline is the machinery underneath: a set of Python scripts and GitHub Actions workflows that monitor system activity across all eight organs, validate essay frontmatter against a strict schema, generate sprint narrative drafts from cross-organ telemetry, and maintain a searchable index of every published essay.

The pipeline operates on a simple principle: the organvm eight-organ system generates a continuous stream of events -- promotions, CI passes, new repos, dependency changes, milestone completions -- and those events are raw material for public discourse. essay-pipeline converts that raw material into structured essay topics, validates that essays meet publication standards before they reach the Jekyll build, and keeps the entire corpus indexed for cross-referencing and discovery.

This repo does not contain essays themselves. It contains the tools that make essay production systematic, consistent, and traceable. Every essay published through public-process passes through this pipeline's validators. Every sprint narrative begins as a draft generated by this pipeline's narrator. Every topic suggestion filed as a GitHub Issue originates from this pipeline's monitor scanning the eight organs for essay-worthy activity.

The design philosophy is automation-as-infrastructure: essay-pipeline should be invisible when working correctly and loud when something breaks. Frontmatter that does not conform to schema should fail CI. Sprint narratives that lack required sections should be flagged before a human ever sees them. The index should always reflect the current state of the published corpus without manual intervention.

## Architecture

The pipeline follows a four-stage linear flow, each stage implemented as an independent Python module that can run standalone or be orchestrated through GitHub Actions:

```
                    +-----------+
                    |  MONITOR  |  Scans 8 orgs for essay-worthy events
                    +-----+-----+
                          |
                          v
                    +-----------+
                    | NARRATOR  |  Generates sprint narrative drafts
                    +-----+-----+
                          |
                          v
                    +-----------+
                    | VALIDATOR |  Enforces frontmatter schema on all essays
                    +-----+-----+
                          |
                          v
                    +-----------+
                    |  INDEXER  |  Rebuilds searchable essay catalog
                    +-----------+
```

**Monitor** runs on a weekly cron schedule (Monday 06:00 UTC). It uses the GitHub API to scan all eight organvm organizations for recent activity: new repositories, tier promotions, CI status changes, dependency graph updates, milestone completions, and release events. It scores each event by essay-worthiness using a weighted heuristic (cross-organ events score higher than single-repo events; first-time events score higher than recurring ones). Events above the threshold become GitHub Issues in public-process, tagged `essay-topic` and `auto-generated`.

**Narrator** is triggered after monitor completes or can be invoked manually. It takes a sprint identifier (e.g., `LOGOS`, `PLATINUM`) and a date range, then queries the GitHub API for all commits, PRs, issues, and deployments within that window across all eight organs. It assembles a structured Markdown draft with standard sections: Sprint Context, Key Achievements, Technical Decisions, Cross-Organ Impact, Metrics, and Reflection Prompts. The draft is committed to a branch in public-process for human review and editing.

**Validator** runs on every push to public-process's `_posts/` directory. It parses YAML frontmatter from each Markdown file and checks it against the required schema (see Frontmatter Schema below). Validation failures produce clear error messages with line numbers and field names. Validator also checks for orphaned essays (files in `_posts/` not present in the index), duplicate slugs, and date consistency (the filename date must match the frontmatter date).

**Indexer** runs after validator passes. It reads every essay in `_posts/`, extracts frontmatter metadata, computes word counts, and generates a JSON index file (`essays-index.json`) that public-process can use for search, tag pages, related-post suggestions, and the essay archive. The index includes every field from frontmatter plus computed fields: word count, reading time estimate, slug, and permalink.

## Components

### `src/monitor.py`

The system activity scanner. Connects to the GitHub API using a PAT with read access to all eight organvm organizations. Iterates through each org's repositories, collecting events from the last 7 days (configurable). Events are classified into categories:

- **repo.created** -- A new repository appeared in any organ
- **promotion.completed** -- A repo changed tier (stub to standard, standard to flagship)
- **ci.status_change** -- A repo's CI went from failing to passing (or vice versa)
- **dependency.added** -- A new cross-organ dependency was registered
- **milestone.reached** -- A repository hit a defined milestone
- **release.published** -- A new release tag was pushed

Each event gets a composite score based on category weight, cross-organ impact, and novelty. Events scoring above the configurable threshold (default: 0.6) are formatted as GitHub Issue bodies and filed in public-process via the API.

### `src/narrator.py`

The sprint narrative generator. Takes a sprint name and date range as CLI arguments. Queries the GitHub API for all activity within that window, then renders a Markdown document using Jinja2 templates stored in `templates/`. The generated narrative follows a fixed structure designed to match the editorial voice established in the first ten meta-system essays.

Templates are intentionally minimal -- they provide section headers, data placeholders, and reflection prompts but leave the actual prose to human authors. The narrator generates a first draft, not a finished essay. Its value is in aggregating data that would take hours to collect manually: commit counts by organ, PR merge rates, new dependency edges, CI pass rates, and cross-references to related essays.

### `src/validator.py`

The frontmatter schema enforcer. Reads Markdown files, extracts the YAML frontmatter block (delimited by `---`), and validates each field against the schema definition in `schema/frontmatter.yaml`. Validation is strict: unknown fields are rejected, required fields must be present, date formats must match ISO 8601, tags must come from a controlled vocabulary (with an escape hatch for new tags that are explicitly marked `provisional`).

Validator outputs structured JSON when run in CI mode (`--ci`) for easy parsing by downstream tools, or human-readable text when run locally. Exit code 0 means all essays pass; exit code 1 means at least one validation error was found.

### `src/indexer.py`

The essay catalog builder. Reads every validated essay, extracts metadata, computes derived fields, and writes `essays-index.json`. The index is a flat JSON array of objects, one per essay, sorted by date descending. The indexer also detects structural issues: essays referenced in the index but missing from `_posts/`, essays present in `_posts/` but missing from the index (these should not exist after a clean run), and essays with duplicate slugs.

The index file is committed to public-process and consumed by the Jekyll build for generating tag pages, the essay archive, related-post links, and the Atom feed's metadata.

### `src/config.py`

Shared configuration module. Loads settings from environment variables with sensible defaults. Key settings include: GitHub PAT location, organization list, scoring thresholds, template paths, schema paths, and output directories. All paths are relative to the repo root to support both local development and CI execution.

### `schema/frontmatter.yaml`

The canonical frontmatter schema definition. This file is the single source of truth for what constitutes valid essay frontmatter. It is consumed by `validator.py` at runtime and by the ADR documentation for human reference.

### `templates/`

Jinja2 templates used by the narrator to generate sprint narrative drafts. Templates are versioned alongside the code so that narrative structure changes are tracked in git history.

## Frontmatter Schema

Every essay published through public-process must include YAML frontmatter conforming to this schema:

```yaml
---
layout: post                    # Required. Must be "post".
title: "Essay Title"            # Required. String, 10-200 characters.
date: 2026-02-17                # Required. ISO 8601 date. Must match filename date.
author: "4444J99"               # Required. GitHub username.
tags:                           # Required. List of 1-5 tags.
  - meta-system
  - sprint-narrative
organ: V                        # Required. Roman numeral I-VII or META.
sprint: "LOGOS"                  # Optional. Sprint identifier if essay is sprint-related.
series: "meta-system"           # Optional. Series name for multi-part essays.
series_order: 6                 # Required if series is set. Integer >= 1.
abstract: "One-paragraph..."    # Required. 50-500 characters. Used in index and feed.
status: published               # Required. One of: draft, review, published, archived.
---
```

**Validation rules:**

| Field | Type | Required | Constraints |
|-------|------|----------|-------------|
| `layout` | string | yes | Must be `"post"` |
| `title` | string | yes | 10-200 characters |
| `date` | date | yes | ISO 8601, must match filename |
| `author` | string | yes | Valid GitHub username |
| `tags` | list | yes | 1-5 items from controlled vocabulary |
| `organ` | string | yes | `I`, `II`, `III`, `IV`, `V`, `VI`, `VII`, or `META` |
| `sprint` | string | no | Uppercase alphanumeric + hyphens |
| `series` | string | no | Lowercase alphanumeric + hyphens |
| `series_order` | integer | conditional | Required if `series` is set; >= 1 |
| `abstract` | string | yes | 50-500 characters |
| `status` | enum | yes | `draft`, `review`, `published`, `archived` |

Unknown fields cause validation failure. This is intentional -- it prevents frontmatter drift and forces schema evolution to go through a proper ADR process (see `docs/adr/002-frontmatter-schema-design.md`).

## Workflow Integration

essay-pipeline's scripts are invoked through three GitHub Actions workflows:

### Weekly Monitor (`monitor.yml`)

Runs every Monday at 06:00 UTC. Executes `src/monitor.py` with the GitHub PAT from repository secrets. Creates issues in public-process for essay-worthy events. Can be triggered manually via `workflow_dispatch` for ad-hoc scans.

### Essay Validator (`validate.yml`)

Triggered on pushes to public-process that modify files in `_posts/`. Uses `repository_dispatch` to invoke validator and indexer in sequence. Fails the check if any essay has invalid frontmatter. On success, commits the updated `essays-index.json` back to public-process.

### Sprint Narrator (`narrate.yml`)

Triggered manually via `workflow_dispatch` with sprint name and date range as inputs. Generates a narrative draft and opens a pull request in public-process with the draft for review.

### CI (`ci.yml`)

Standard validation on every push: checks repo structure (README, LICENSE, seed.yaml), runs Python linting if Python files are detected, and validates the frontmatter schema definition itself.

## Cross-Organ Event Flow

essay-pipeline sits at the center of a cross-organ information flow. Here is how events propagate:

```
ORGAN-IV (orchestration-start-here)
  |
  |  promotion.completed event
  |  (repo changes tier)
  v
essay-pipeline (monitor.py)
  |
  |  Creates GitHub Issue
  |  in public-process
  v
ORGAN-V (public-process)
  |
  |  Human writes essay
  |  referencing the event
  v
essay-pipeline (validator.py)
  |
  |  Validates frontmatter
  |  Rebuilds index
  v
ORGAN-V (public-process Jekyll build)
  |
  |  essay.published event
  |  (new post appears on site)
  v
ORGAN-IV (distribute-content.yml)
  |
  |  POSSE distribution
  |  Mastodon + Discord
  v
External audience
```

This flow means essay-pipeline consumes events from all eight organs (via monitor) and produces artifacts consumed by ORGAN-V and ORGAN-IV. It is a pure data-processing node: it reads system state and writes structured documents. It never modifies the source systems it monitors.

### Event Subscriptions

essay-pipeline subscribes to two primary event types:

1. **promotion.completed** (from ORGAN-IV): When orchestration-start-here promotes a repository to a new tier, essay-pipeline detects this and generates a topic suggestion. Promotions are high-signal events that reliably produce good essays because they involve multiple systems working together.

2. **ci.passed** (from all organs): Continuous integration status changes across the system feed into sprint narrative generation. A sprint where 95% of repos have green CI tells a different story than one where CI was being established for the first time.

## Development

### Prerequisites

- Python 3.11+
- A GitHub Personal Access Token with `repo` and `read:org` scope for all eight organvm organizations
- Access to the [public-process](https://github.com/organvm-v-logos/public-process) repository

### Setup

```bash
git clone https://github.com/organvm-v-logos/essay-pipeline.git
cd essay-pipeline
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### Environment Variables

```bash
export GITHUB_TOKEN="ghp_..."          # PAT with repo + read:org scope
export ESSAY_PIPELINE_ORG_LIST="organvm-i-theoria,organvm-ii-poiesis,organvm-iii-ergon,organvm-iv-taxis,organvm-v-logos,organvm-vi-koinonia,organvm-vii-kerygma,meta-organvm"
export ESSAY_PIPELINE_THRESHOLD="0.6"  # Minimum score for topic suggestion
export ESSAY_PIPELINE_OUTPUT_DIR="./output"
```

### Running Locally

```bash
# Run the monitor (scans all orgs for recent activity)
python src/monitor.py --days 7 --output ./output/topics.json

# Generate a sprint narrative draft
python src/narrator.py --sprint LOGOS --from 2026-02-10 --to 2026-02-17 --output ./output/

# Validate essays in a local public-process checkout
python src/validator.py --posts-dir ../public-process/_posts/ --ci

# Rebuild the essay index
python src/indexer.py --posts-dir ../public-process/_posts/ --output ./output/essays-index.json
```

### Testing

```bash
# Run all tests
pytest tests/

# Run with coverage
pytest tests/ --cov=src --cov-report=term-missing

# Run specific test module
pytest tests/test_validator.py -v
```

### Project Structure

```
essay-pipeline/
  .github/
    workflows/
      ci.yml              # Continuous integration
  docs/
    adr/
      001-initial-architecture.md
      002-frontmatter-schema-design.md
  schema/
    frontmatter.yaml      # Canonical frontmatter schema
  src/
    config.py             # Shared configuration
    indexer.py             # Essay catalog builder
    monitor.py            # System activity scanner
    narrator.py           # Sprint narrative generator
    validator.py          # Frontmatter schema enforcer
  templates/
    narrative.md.j2       # Sprint narrative template
    topic-issue.md.j2     # Topic suggestion issue template
  tests/
    test_indexer.py
    test_monitor.py
    test_narrator.py
    test_validator.py
  CHANGELOG.md
  LICENSE
  README.md
  requirements.txt
  seed.yaml
```

## How It Fits the System

essay-pipeline is part of the organvm eight-organ creative-institutional system:

| Organ | Name | Domain | Relationship to essay-pipeline |
|-------|------|--------|-------------------------------|
| I | Theoria | Foundational theory and recursive structures | Monitored for essay-worthy theoretical developments |
| II | Poiesis | Creative production and artistic works | Monitored for creative output milestones |
| III | Ergon | Practical applications and tools | Monitored for tool releases and user-facing changes |
| IV | Taxis | Orchestration, governance, infrastructure | Sends promotion events; receives essay publication signals |
| **V** | **Logos** | **Public process, discourse, essays** | **This repo. Automation engine for the discourse layer.** |
| VI | Koinonia | Community and collaboration | Monitored for community engagement events |
| VII | Kerygma | Proclamation and external communication | Consumes essay index for content distribution |
| META | meta-organvm | Cross-organ umbrella | Monitored for system-wide governance changes |

essay-pipeline exists because a system of 80+ repositories across 8 organizations generates too much activity for manual essay curation. The pipeline ensures that significant events surface as essay topics, that essays meet consistent quality standards, and that the published corpus remains indexed and discoverable. It is ORGAN-V's contribution to the system's self-documenting nature: the system does not just build things -- it writes about building things, and this repo automates the writing infrastructure.

## Design Principles

The pipeline is built on three guiding principles that inform every implementation decision:

**Automation as infrastructure.** The pipeline should be invisible when working correctly. No human should need to remember to run the indexer after publishing an essay, or manually scan eight organizations for essay topics. If a process can be triggered automatically, it must be. Manual intervention is reserved for editorial decisions -- choosing which topics to write about, shaping narrative voice, deciding publication timing.

**Strict schemas with explicit evolution.** Every data contract in the pipeline is formally defined and enforced. Frontmatter fields are validated against a schema. Event scoring uses documented weights. Index structure follows a versioned format. When something needs to change, the change goes through an ADR, not through a quick edit that silently alters behavior. This strictness is a feature: it makes the system predictable and auditable.

**Cross-organ awareness without cross-organ coupling.** The monitor reads from all eight organs but never writes to them. The narrator aggregates data from across the system but produces artifacts only in ORGAN-V. This read-many-write-one pattern keeps the pipeline's blast radius contained. A bug in essay-pipeline cannot corrupt ORGAN-III's build system or ORGAN-IV's orchestration workflows.

## Contributing

Contributions follow the [organvm contribution guidelines](https://github.com/organvm-v-logos/.github/blob/main/CONTRIBUTING.md).

Key points for this repo:

1. **Schema changes** require an ADR in `docs/adr/` before implementation
2. **New event types** in the monitor require updating `seed.yaml`'s `consumes` section
3. **Template changes** should be tested against at least 3 existing essays
4. **All Python code** must pass `ruff check` with zero warnings

To propose a new frontmatter field:
1. Open an issue describing the field, its type, and why it is needed
2. Draft an ADR following the template in `docs/adr/`
3. Implement the field in `schema/frontmatter.yaml` and `src/validator.py`
4. Update the README's Frontmatter Schema section
5. Open a PR referencing the issue and ADR

## License

[MIT](./LICENSE) -- see LICENSE file for full text.

---

_LOGOS Sprint -- organvm-v-logos/essay-pipeline -- February 2026_
